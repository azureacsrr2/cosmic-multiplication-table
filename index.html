<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‡å®™ä¹˜æ³•å£è¯€è¡¨</title>
    <!-- å¼•å…¥Tailwind CSSä»¥è¿›è¡Œæ ·å¼è®¾è®¡ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ä¸­æ–‡å­—ä½“ä»¥ä¼˜åŒ–æ˜¾ç¤º -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- **æ–°åŠŸèƒ½**ï¼šå¼•å…¥Tone.jsåº“æ¥åˆ›å»ºéŸ³æ•ˆå’ŒéŸ³ä¹ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* ä½¿ç”¨æ›´é€‚åˆä¸­æ–‡çš„å­—ä½“ */
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            /* è®¾ç½®ä¸€ä¸ªåå¤‡çš„æ·±è‰²èƒŒæ™¯ï¼Œä»¥é˜²å›¾ç‰‡åŠ è½½å¤±è´¥ */
            background-color: #0f172a;
            /* èƒŒæ™¯å›¾ç‰‡å°†ç”±JavaScriptåŠ¨æ€è®¾ç½® */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            /* ä¸ºèƒŒæ™¯å›¾ç‰‡çš„åˆ‡æ¢æ·»åŠ ä¸€ä¸ªå¹³æ»‘çš„æ·¡å…¥æ•ˆæœ */
            transition: background-image 1s ease-in-out;
        }
        /* ä¸ºæ ‡é¢˜å’Œæ®µè½æ·»åŠ æ–‡æœ¬é˜´å½±ä»¥æé«˜åœ¨èƒŒæ™¯å›¾ç‰‡ä¸Šçš„å¯è¯»æ€§ */
        h1, .container > p {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        }
        
        /* ä¸ºæŒ‰é’®æ·»åŠ ç®€å•çš„ç‚¹å‡»åŠ¨ç”»æ•ˆæœ */
        .btn-speak, #check-answer-btn, #new-question-btn, #start-quiz-btn {
            transition: all 0.2s ease-in-out;
        }
        .btn-speak {
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-speak:active {
            transform: scale(0.95) rotate(-2deg); /* ç‚¹å‡»æ—¶å¢åŠ ä¸€ä¸ªå¯çˆ±çš„æ—‹è½¬æ•ˆæœ */
        }
        .btn-speak:hover {
            box-shadow: 0 0 15px rgba(107, 114, 128, 0.5);
        }
        #check-answer-btn:active, #new-question-btn:active, #start-quiz-btn:active {
             transform: scale(0.95);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="container mx-auto text-center">
        
        <!-- æµ‹éªŒå¯åŠ¨æŒ‰é’® -->
        <div id="start-quiz-container" class="mb-10 p-6 rounded-2xl bg-slate-800/80 backdrop-blur-sm border border-slate-700 shadow-lg w-full max-w-md mx-auto">
            <h2 class="text-2xl font-bold text-cyan-300 mb-4">å‡†å¤‡å¥½äº†å—ï¼Ÿ</h2>
            <button id="start-quiz-btn" class="w-full bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-4 px-4 rounded-lg text-xl">å¼€å§‹æŒ‘æˆ˜ï¼</button>
        </div>

        <!-- æµ‹éªŒéƒ¨åˆ† (åˆå§‹éšè—) -->
        <div id="quiz-section" class="hidden mb-10 p-6 rounded-2xl bg-slate-800/80 backdrop-blur-sm border border-slate-700 shadow-lg w-full max-w-md mx-auto">
            <h2 class="text-2xl font-bold text-cyan-300 mb-4">ä¹˜æ³•æŒ‘æˆ˜</h2>
            <div id="quiz-question" class="text-4xl font-bold text-white mb-2 h-12"></div>
            <div id="quiz-mnemonic-hint" class="text-xl text-gray-300 mb-4 h-8"></div>
            <div class="flex items-center justify-center gap-4">
                <input type="number" id="quiz-answer" class="text-center text-2xl font-bold w-24 h-14 rounded-lg bg-slate-900 text-white border-2 border-slate-600 focus:border-cyan-400 focus:ring-0" placeholder="?">
                <button id="check-answer-btn" class="w-24 h-14 bg-emerald-500 hover:bg-emerald-400 text-white font-bold text-lg rounded-lg">ç¡®è®¤</button>
            </div>
            <div id="quiz-feedback" class="mt-4 text-lg h-8"></div>
            <button id="new-question-btn" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-4 rounded-lg">ä¸‹ä¸€é¢˜</button>
        </div>

        <h1 class="text-4xl font-bold mb-2 text-cyan-400 tracking-wider">å®‡å®™ä¹˜æ³•å£è¯€è¡¨</h1>
        <p class="text-gray-300 mb-8">ç‚¹å‡»ä¸‹æ–¹çš„æŒ‰é’®ï¼Œæ¢ç´¢ä¹˜æ³•å£è¯€çš„å¥¥ç§˜ï¼</p>
        
        <!-- ä¹˜æ³•å£è¯€è¡¨çš„å®¹å™¨ -->
        <div id="multiplication-table" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-9 gap-3 md:gap-4 max-w-5xl mx-auto">
            <!-- æŒ‰é’®å°†ç”±ä¸‹æ–¹çš„JavaScriptä»£ç åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <script>
        const tableContainer = document.getElementById('multiplication-table');

        // --- åŠ¨æ€èƒŒæ™¯ä»£ç  ---
        document.addEventListener('DOMContentLoaded', function() {
            const backgrounds = [
                'https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop',
                'https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto=format&fit=crop',
                'https://images.unsplash.com/photo-1446776811953-b23d5795b4e6?q=80&w=2072&auto=format&fit=crop',
                'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?q=80&w=1844&auto=format&fit=crop',
                'https://images.unsplash.com/photo-1506443432602-ac2fcd6f54e0?q=80&w=1974&auto=format&fit=crop'
            ];
            const randomIndex = Math.floor(Math.random() * backgrounds.length);
            const selectedImage = backgrounds[randomIndex];
            document.body.style.backgroundImage = `url(${selectedImage})`;
        });
        // --- åŠ¨æ€èƒŒæ™¯ä»£ç ç»“æŸ ---

        // å®šä¹‰ä¸­æ–‡ä¹˜æ³•å£è¯€çš„æ•°æ®å¯¹è±¡
        const mnemonics = {
            1: { 1: "ä¸€ä¸€å¾—ä¸€", 2: "ä¸€äºŒå¾—äºŒ", 3: "ä¸€ä¸‰å¾—ä¸‰", 4: "ä¸€å››å¾—å››", 5: "ä¸€äº”å¾—äº”", 6: "ä¸€å…­å¾—å…­", 7: "ä¸€ä¸ƒå¾—ä¸ƒ", 8: "ä¸€å…«å¾—å…«", 9: "ä¸€ä¹å¾—ä¹" },
            2: { 2: "äºŒäºŒå¾—å››", 3: "äºŒä¸‰å¾—å…­", 4: "äºŒå››å¾—å…«", 5: "äºŒäº”ä¸€å", 6: "äºŒå…­åäºŒ", 7: "äºŒä¸ƒåå››", 8: "äºŒå…«åå…­", 9: "äºŒä¹åå…«" },
            3: { 3: "ä¸‰ä¸‰å¾—ä¹", 4: "ä¸‰å››åäºŒ", 5: "ä¸‰äº”åäº”", 6: "ä¸‰å…­åå…«", 7: "ä¸‰ä¸ƒäºŒåä¸€", 8: "ä¸‰å…«äºŒåå››", 9: "ä¸‰ä¹äºŒåä¸ƒ" },
            4: { 4: "å››å››åå…­", 5: "å››äº”äºŒå", 6: "å››å…­äºŒåå››", 7: "å››ä¸ƒäºŒåå…«", 8: "å››å…«ä¸‰åäºŒ", 9: "å››ä¹ä¸‰åå…­" },
            5: { 5: "äº”äº”äºŒåäº”", 6: "äº”å…­ä¸‰å", 7: "äº”ä¸ƒä¸‰åäº”", 8: "äº”å…«å››å", 9: "äº”ä¹å››åäº”" },
            6: { 6: "å…­å…­ä¸‰åå…­", 7: "å…­ä¸ƒå››åäºŒ", 8: "å…­å…«å››åå…«", 9: "å…­ä¹äº”åå››" },
            7: { 7: "ä¸ƒä¸ƒå››åä¹", 8: "ä¸ƒå…«äº”åå…­", 9: "ä¸ƒä¹å…­åä¸‰" },
            8: { 8: "å…«å…«å…­åå››", 9: "å…«ä¹ä¸ƒåäºŒ" },
            9: { 9: "ä¹ä¹å…«åä¸€" }
        };

        const spaceEmojis = ["â˜€ï¸", "ğŸš€", "ğŸª", "ğŸŒ", "ğŸŒŸ", "â˜„ï¸", "ğŸŒ•", "ğŸŒŒ", "ğŸ‘½"];
        const spaceColors = [
            'bg-indigo-600 hover:bg-indigo-500', 'bg-sky-600 hover:bg-sky-500',
            'bg-rose-600 hover:bg-rose-500', 'bg-emerald-600 hover:bg-emerald-500',
            'bg-purple-600 hover:bg-purple-500', 'bg-amber-600 hover:bg-amber-500',
            'bg-cyan-600 hover:bg-cyan-500', 'bg-violet-600 hover:bg-violet-500',
            'bg-fuchsia-600 hover:bg-fuchsia-500'
        ];

        let currentAudio = null;

        function speak(text, onEndCallback) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            const encodedText = encodeURIComponent(text);
            const apiUrl = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=zh-CN&client=tw-ob`;
            currentAudio = new Audio(apiUrl);
            if (onEndCallback) {
                currentAudio.addEventListener('ended', onEndCallback, { once: true });
            }
            currentAudio.play().catch(e => console.error("éŸ³é¢‘æ’­æ”¾å¤±è´¥:", e));
        }

        // --- **æ–°åŠŸèƒ½**ï¼šéŸ³æ•ˆå’ŒéŸ³ä¹ ---
        let synth, backgroundMusic;

        // æ­£ç¡®çš„éŸ³æ•ˆ
        function playCorrectSound() {
            if (!synth) return;
            synth.triggerAttackRelease("C5", "8n", Tone.now());
            synth.triggerAttackRelease("E5", "8n", Tone.now() + 0.1);
            synth.triggerAttackRelease("G5", "8n", Tone.now() + 0.2);
        }

        // é”™è¯¯çš„éŸ³æ•ˆ
        function playIncorrectSound() {
            if (!synth) return;
            synth.triggerAttackRelease("C3", "8n", Tone.now());
        }
        
        // ç‚¹å‡»çš„éŸ³æ•ˆ
        function playClickSound() {
            if (!synth) return;
            synth.triggerAttackRelease("C6", "16n");
        }
        
        // åˆå§‹åŒ–æ‰€æœ‰å£°éŸ³
        function initializeAudio() {
             // åˆ›å»ºä¸€ä¸ªåˆæˆå™¨ç”¨äºéŸ³æ•ˆ
            synth = new Tone.Synth({
                oscillator: { type: "sine" },
                envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
            }).toDestination();
            
            // åˆ›å»ºèƒŒæ™¯éŸ³ä¹
            backgroundMusic = new Tone.Player({
                url: "https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus/0000_Sitar_0_84_11.mp3", // ä½¿ç”¨ä¸€ä¸ªå®‰é™å¹³å’Œçš„ä¹å™¨å£°ä½œä¸ºèƒŒæ™¯
                loop: true,
                autostart: true,
                volume: -20, // å°†éŸ³é‡è°ƒä½ï¼Œä¸å¹²æ‰°å­¦ä¹ 
                fadeIn: 2,
            }).toDestination();
            
            // ç¡®ä¿Tone.jsåœ¨ç”¨æˆ·äº¤äº’åå¯åŠ¨
            Tone.start();
        }
        // --- éŸ³æ•ˆä»£ç ç»“æŸ ---


        // --- æµ‹éªŒéƒ¨åˆ†ä»£ç  ---
        const startQuizContainer = document.getElementById('start-quiz-container');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizSection = document.getElementById('quiz-section');
        const quizQuestionEl = document.getElementById('quiz-question');
        const quizMnemonicHintEl = document.getElementById('quiz-mnemonic-hint');
        const quizAnswerEl = document.getElementById('quiz-answer');
        const checkAnswerBtn = document.getElementById('check-answer-btn');
        const newQuestionBtn = document.getElementById('new-question-btn');
        const quizFeedbackEl = document.getElementById('quiz-feedback');
        
        let currentNum1, currentNum2;

        function generateNewQuestion() {
            currentNum1 = Math.floor(Math.random() * 9) + 1;
            currentNum2 = Math.floor(Math.random() * 9) + 1;
            const smallerNum = Math.min(currentNum1, currentNum2);
            const largerNum = Math.max(currentNum1, currentNum2);
            const mnemonic = mnemonics[smallerNum][largerNum];
            let mnemonicQuestion;
            if (mnemonic.includes('å¾—')) {
                const questionPartEnd = mnemonic.indexOf('å¾—') + 1;
                mnemonicQuestion = mnemonic.substring(0, questionPartEnd) + '?';
            } else {
                mnemonicQuestion = mnemonic.slice(0, 2) + '?';
            }
            quizQuestionEl.textContent = `${currentNum1} Ã— ${currentNum2} = ?`;
            quizMnemonicHintEl.textContent = `${mnemonicQuestion}ï¼Ÿ`;
            quizAnswerEl.value = '';
            quizAnswerEl.disabled = false;
            checkAnswerBtn.disabled = false;
            quizFeedbackEl.textContent = '';
            quizFeedbackEl.className = 'mt-4 text-lg h-8'; 
            speak(`${mnemonicQuestion}ï¼Œè¯·ç­”é¢˜`);
        }

        function checkAnswer() {
            if (quizAnswerEl.disabled) return;
            const userAnswer = parseInt(quizAnswerEl.value, 10);
            const correctAnswer = currentNum1 * currentNum2;
            const smallerNum = Math.min(currentNum1, currentNum2);
            const largerNum = Math.max(currentNum1, currentNum2);
            const fullMnemonic = mnemonics[smallerNum][largerNum];

            if (userAnswer === correctAnswer) {
                playCorrectSound(); // æ’­æ”¾æ­£ç¡®çš„éŸ³æ•ˆ
                quizFeedbackEl.textContent = 'ç­”å¯¹äº†ï¼ä½ çœŸæ£’ï¼ğŸ¥³';
                quizFeedbackEl.className = 'mt-4 text-lg h-8 text-green-400 font-bold';
                quizAnswerEl.disabled = true;
                checkAnswerBtn.disabled = true;
                speak(fullMnemonic, () => speak("å¤ªæ£’äº†ï¼"));
            } else {
                playIncorrectSound(); // æ’­æ”¾é”™è¯¯çš„éŸ³æ•ˆ
                quizFeedbackEl.textContent = 'ä¸å¯¹å“¦ï¼Œå†æƒ³ä¸€æƒ³ï¼ğŸ¤”';
                quizFeedbackEl.className = 'mt-4 text-lg h-8 text-amber-400 font-bold';
                speak("ä¸å¯¹å“¦ï¼Œå†æƒ³ä¸€æƒ³");
                quizAnswerEl.value = '';
            }
        }
        
        startQuizBtn.addEventListener('click', () => {
            initializeAudio(); // åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶åˆå§‹åŒ–æ‰€æœ‰éŸ³é¢‘
            startQuizContainer.classList.add('hidden');
            quizSection.classList.remove('hidden');
            generateNewQuestion();
        });

        newQuestionBtn.addEventListener('click', generateNewQuestion);
        checkAnswerBtn.addEventListener('click', checkAnswer);
        quizAnswerEl.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') checkAnswer();
        });

        // --- å£è¯€è¡¨ç”Ÿæˆä»£ç  ---
        for (let i = 1; i <= 9; i++) {
            for (let j = 1; j <= 9; j++) {
                const button = document.createElement('button');
                const colorClass = spaceColors[(i - 1) % spaceColors.length];
                button.className = `btn-speak ${colorClass} text-white font-bold p-2 rounded-xl shadow-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75 flex flex-col items-center justify-center aspect-square`;
                const emoji_i = spaceEmojis[i - 1];
                button.innerHTML = `
                    <div class="text-3xl sm:text-4xl" aria-hidden="true">${emoji_i}</div>
                    <div class="text-sm sm:text-base mt-1 font-semibold">${i} Ã— ${j} = ${i * j}</div>
                `;
                button.setAttribute('aria-label', `${i} ä¹˜ ${j} ç­‰äº ${i*j}ã€‚å£è¯€æ˜¯ï¼š${mnemonics[Math.min(i,j)][Math.max(i,j)]}`);
                button.addEventListener('click', () => {
                    playClickSound(); // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                    const num1 = Math.min(i, j);
                    const num2 = Math.max(i, j);
                    const mnemonic = mnemonics[num1][num2];
                    speak(mnemonic);
                });
                tableContainer.appendChild(button);
            }
        }
        
        // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ ç‚¹å‡»éŸ³æ•ˆ
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', playClickSound);
        });

    </script>
</body>
</html>

