<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‡å®™ä¹˜æ³•å£è¨£è¡¨</title>
    <!-- å¼•å…¥Tailwind CSSä»¥é€²è¡Œæ¨£å¼è¨­è¨ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ä¸­æ–‡å­—é«”ä»¥å„ªåŒ–é¡¯ç¤º -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- å¼•å…¥Tone.jsåº«ä¾†å‰µå»ºéŸ³æ•ˆå’ŒéŸ³æ¨‚ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* ä½¿ç”¨æ›´é©åˆä¸­æ–‡çš„å­—é«” */
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            /* è¨­å®šä¸€å€‹å¾Œå‚™çš„æ·±è‰²èƒŒæ™¯ï¼Œä»¥é˜²åœ–ç‰‡è¼‰å…¥å¤±æ•— */
            background-color: #0f172a;
            /* èƒŒæ™¯åœ–ç‰‡å°‡ç”±JavaScriptå‹•æ…‹è¨­å®š */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            /* ç‚ºèƒŒæ™¯åœ–ç‰‡çš„åˆ‡æ›æ·»åŠ ä¸€å€‹å¹³æ»‘çš„æ·¡å…¥æ•ˆæœ */
            transition: background-image 1s ease-in-out;
        }
        /* ç‚ºæ¨™é¡Œå’Œæ®µè½æ·»åŠ æ–‡æœ¬é™°å½±ä»¥æé«˜åœ¨èƒŒæ™¯åœ–ç‰‡ä¸Šçš„å¯è®€æ€§ */
        h1, .container > p {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        }
        
        /* ç‚ºæŒ‰éˆ•æ·»åŠ ç°¡å–®çš„é»æ“Šå‹•ç•«æ•ˆæœ */
        .btn-speak, #check-answer-btn, #new-question-btn, #start-quiz-btn {
            transition: all 0.2s ease-in-out;
        }
        .btn-speak {
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-speak:active {
            transform: scale(0.95) rotate(-2deg); /* é»æ“Šæ™‚å¢åŠ ä¸€å€‹å¯æ„›çš„æ—‹è½‰æ•ˆæœ */
        }
        .btn-speak:hover {
            box-shadow: 0 0 15px rgba(107, 114, 128, 0.5);
        }
        #check-answer-btn:active, #new-question-btn:active, #start-quiz-btn:active {
             transform: scale(0.95);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="container mx-auto text-center">
        
        <!-- æ¸¬é©—å•Ÿå‹•æŒ‰éˆ• -->
        <div id="start-quiz-container" class="mb-10 p-6 rounded-2xl bg-slate-800/80 backdrop-blur-sm border border-slate-700 shadow-lg w-full max-w-md mx-auto">
            <h2 class="text-2xl font-bold text-cyan-300 mb-4">æº–å‚™å¥½äº†å—ï¼Ÿ</h2>
            <button id="start-quiz-btn" class="w-full bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-4 px-4 rounded-lg text-xl">é–‹å§‹æŒ‘æˆ°ï¼</button>
        </div>

        <!-- æ¸¬é©—éƒ¨åˆ† (åˆå§‹éš±è—) -->
        <div id="quiz-section" class="hidden mb-10 p-6 rounded-2xl bg-slate-800/80 backdrop-blur-sm border border-slate-700 shadow-lg w-full max-w-md mx-auto">
            <h2 class="text-2xl font-bold text-cyan-300 mb-4">ä¹˜æ³•æŒ‘æˆ°</h2>
            <div id="quiz-question" class="text-4xl font-bold text-white mb-2 h-12"></div>
            <div id="quiz-mnemonic-hint" class="text-xl text-gray-300 mb-4 h-8"></div>
            <div class="flex items-center justify-center gap-4">
                <input type="number" id="quiz-answer" class="text-center text-2xl font-bold w-24 h-14 rounded-lg bg-slate-900 text-white border-2 border-slate-600 focus:border-cyan-400 focus:ring-0" placeholder="?">
                <button id="check-answer-btn" class="w-24 h-14 bg-emerald-500 hover:bg-emerald-400 text-white font-bold text-lg rounded-lg">ç¢ºèª</button>
            </div>
            <div id="quiz-feedback" class="mt-4 text-lg h-8"></div>
            <button id="new-question-btn" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-4 rounded-lg">ä¸‹ä¸€é¡Œ</button>
        </div>

        <h1 class="text-4xl font-bold mb-2 text-cyan-400 tracking-wider">å®‡å®™ä¹˜æ³•å£è¨£è¡¨</h1>
        <p class="text-gray-300 mb-8">é»æ“Šä¸‹æ–¹çš„æŒ‰éˆ•ï¼Œæ¢ç´¢ä¹˜æ³•å£è¨£çš„å¥§ç§˜ï¼</p>
        
        <!-- ä¹˜æ³•å£è¨£è¡¨çš„å®¹å™¨ -->
        <div id="multiplication-table" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-9 gap-3 md:gap-4 max-w-5xl mx-auto">
            <!-- æŒ‰éˆ•å°‡ç”±ä¸‹æ–¹çš„JavaScriptç¨‹å¼ç¢¼å‹•æ…‹ç”¢ç”Ÿ -->
        </div>
    </div>

    <script>
        const tableContainer = document.getElementById('multiplication-table');

        // --- æ¯æ—¥å¿…æ‡‰å£ç´™ ---
        document.addEventListener('DOMContentLoaded', function() {
            // ä½¿ç”¨ä¸€å€‹å¯é çš„APIä¾†ç²å–å¿…æ‡‰æ¯æ—¥å£ç´™
            const bingApiUrl = 'https://bing.biturl.top/?resolution=1920&format=json&index=0&mkt=zh-CN';
            
            fetch(bingApiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.url) {
                        document.body.style.backgroundImage = `url(${data.url})`;
                    }
                })
                .catch(error => {
                    console.error("ç„¡æ³•è¼‰å…¥å¿…æ‡‰å£ç´™:", error);
                });
        });
        // --- æ¯æ—¥å£ç´™ç¨‹å¼ç¢¼çµæŸ ---

        // å®šç¾©ä¸­æ–‡ä¹˜æ³•å£è¨£çš„è³‡æ–™ç‰©ä»¶
        const mnemonics = {
            1: { 1: "ä¸€ä¸€å¾—ä¸€", 2: "ä¸€äºŒå¾—äºŒ", 3: "ä¸€ä¸‰å¾—ä¸‰", 4: "ä¸€å››å¾—å››", 5: "ä¸€äº”å¾—äº”", 6: "ä¸€å…­å¾—å…­", 7: "ä¸€ä¸ƒå¾—ä¸ƒ", 8: "ä¸€å…«å¾—å…«", 9: "ä¸€ä¹å¾—ä¹" },
            2: { 2: "äºŒäºŒå¾—å››", 3: "äºŒä¸‰å¾—å…­", 4: "äºŒå››å¾—å…«", 5: "äºŒäº”ä¸€å", 6: "äºŒå…­åäºŒ", 7: "äºŒä¸ƒåå››", 8: "äºŒå…«åå…­", 9: "äºŒä¹åå…«" },
            3: { 3: "ä¸‰ä¸‰å¾—ä¹", 4: "ä¸‰å››åäºŒ", 5: "ä¸‰äº”åäº”", 6: "ä¸‰å…­åå…«", 7: "ä¸‰ä¸ƒäºŒåä¸€", 8: "ä¸‰å…«äºŒåå››", 9: "ä¸‰ä¹äºŒåä¸ƒ" },
            4: { 4: "å››å››åå…­", 5: "å››äº”äºŒå", 6: "å››å…­äºŒåå››", 7: "å››ä¸ƒäºŒåå…«", 8: "å››å…«ä¸‰åäºŒ", 9: "å››ä¹ä¸‰åå…­" },
            5: { 5: "äº”äº”äºŒåäº”", 6: "äº”å…­ä¸‰å", 7: "äº”ä¸ƒä¸‰åäº”", 8: "äº”å…«å››å", 9: "äº”ä¹å››åäº”" },
            6: { 6: "å…­å…­ä¸‰åå…­", 7: "å…­ä¸ƒå››åäºŒ", 8: "å…­å…«å››åå…«", 9: "å…­ä¹äº”åå››" },
            7: { 7: "ä¸ƒä¸ƒå››åä¹", 8: "ä¸ƒå…«äº”åå…­", 9: "ä¸ƒä¹å…­åä¸‰" },
            8: { 8: "å…«å…«å…­åå››", 9: "å…«ä¹ä¸ƒåäºŒ" },
            9: { 9: "ä¹ä¹å…«åä¸€" }
        };

        const spaceEmojis = ["â˜€ï¸", "ğŸš€", "ğŸª", "ğŸŒ", "ğŸŒŸ", "â˜„ï¸", "ğŸŒ•", "ğŸŒŒ", "ğŸ‘½"];
        const spaceColors = [
            'bg-indigo-600 hover:bg-indigo-500', 'bg-sky-600 hover:bg-sky-500',
            'bg-rose-600 hover:bg-rose-500', 'bg-emerald-600 hover:bg-emerald-500',
            'bg-purple-600 hover:bg-purple-500', 'bg-amber-600 hover:bg-amber-500',
            'bg-cyan-600 hover:bg-cyan-500', 'bg-violet-600 hover:bg-violet-500',
            'bg-fuchsia-600 hover:bg-fuchsia-500'
        ];

        let currentAudio = null;

        function speak(text, onEndCallback) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            const encodedText = encodeURIComponent(text);
            const apiUrl = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=zh-CN&client=tw-ob`;
            currentAudio = new Audio(apiUrl);
            if (onEndCallback) {
                currentAudio.addEventListener('ended', onEndCallback, { once: true });
            }
            currentAudio.play().catch(e => console.error("éŸ³è¨Šæ’­æ”¾å¤±æ•—:", e));
        }

        // --- éŸ³æ•ˆå’ŒéŸ³æ¨‚ ---
        let synth, backgroundMusic;
        let isAudioInitialized = false;

        function playCorrectSound() {
            if (!synth) return;
            synth.triggerAttackRelease("C5", "8n", Tone.now());
            synth.triggerAttackRelease("E5", "8n", Tone.now() + 0.1);
            synth.triggerAttackRelease("G5", "8n", Tone.now() + 0.2);
        }

        function playIncorrectSound() {
            if (!synth) return;
            synth.triggerAttackRelease("C3", "8n", Tone.now());
        }
        
        function playClickSound() {
            if (!synth) return;
            synth.triggerAttackRelease("C6", "16n");
        }
        
        function initializeAudio() {
            if(isAudioInitialized) return;
            isAudioInitialized = true;
            
            // ä½¿ç”¨è€…äº’å‹•å¾Œå•Ÿå‹•Tone.js
            Tone.start();
             
            synth = new Tone.Synth({
                oscillator: { type: "sine" },
                envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
            }).toDestination();
            
            backgroundMusic = new Tone.Player({
                url: "https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus/0000_Sitar_0_84_11.mp3",
                loop: true,
                volume: -20,
                fadeIn: 2,
            }).toDestination();
        }
        // --- éŸ³æ•ˆç¨‹å¼ç¢¼çµæŸ ---

        // --- æ¸¬é©—éƒ¨åˆ†ç¨‹å¼ç¢¼ ---
        const startQuizContainer = document.getElementById('start-quiz-container');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizSection = document.getElementById('quiz-section');
        const quizQuestionEl = document.getElementById('quiz-question');
        const quizMnemonicHintEl = document.getElementById('quiz-mnemonic-hint');
        const quizAnswerEl = document.getElementById('quiz-answer');
        const checkAnswerBtn = document.getElementById('check-answer-btn');
        const newQuestionBtn = document.getElementById('new-question-btn');
        const quizFeedbackEl = document.getElementById('quiz-feedback');
        
        let currentNum1, currentNum2;

        function generateNewQuestion() {
            currentNum1 = Math.floor(Math.random() * 9) + 1;
            currentNum2 = Math.floor(Math.random() * 9) + 1;
            const smallerNum = Math.min(currentNum1, currentNum2);
            const largerNum = Math.max(currentNum1, currentNum2);
            const mnemonic = mnemonics[smallerNum][largerNum];
            let mnemonicQuestion;
            if (mnemonic.includes('å¾—')) {
                const questionPartEnd = mnemonic.indexOf('å¾—') + 1;
                mnemonicQuestion = mnemonic.substring(0, questionPartEnd) + '?';
            } else {
                mnemonicQuestion = mnemonic.slice(0, 2) + '?';
            }
            quizQuestionEl.textContent = `${currentNum1} Ã— ${currentNum2} = ?`;
            quizMnemonicHintEl.textContent = `${mnemonicQuestion}ï¼Ÿ`;
            quizAnswerEl.value = '';
            quizAnswerEl.disabled = false;
            checkAnswerBtn.disabled = false;
            quizFeedbackEl.textContent = '';
            quizFeedbackEl.className = 'mt-4 text-lg h-8'; 
            speak(`${mnemonicQuestion}ï¼Œè«‹ç­”é¡Œ`);
        }

        function checkAnswer() {
            playClickSound();
            if (quizAnswerEl.disabled) return;
            const userAnswer = parseInt(quizAnswerEl.value, 10);
            const correctAnswer = currentNum1 * currentNum2;
            const smallerNum = Math.min(currentNum1, currentNum2);
            const largerNum = Math.max(currentNum1, currentNum2);
            const fullMnemonic = mnemonics[smallerNum][largerNum];

            if (userAnswer === correctAnswer) {
                playCorrectSound();
                quizFeedbackEl.textContent = 'ç­”å°äº†ï¼ä½ çœŸæ£’ï¼ğŸ¥³';
                quizFeedbackEl.className = 'mt-4 text-lg h-8 text-green-400 font-bold';
                quizAnswerEl.disabled = true;
                checkAnswerBtn.disabled = true;
                speak(fullMnemonic, () => speak("å¤ªæ£’äº†ï¼"));
            } else {
                playIncorrectSound();
                quizFeedbackEl.textContent = 'ä¸å°å–”ï¼Œå†æƒ³ä¸€æƒ³ï¼ğŸ¤”';
                quizFeedbackEl.className = 'mt-4 text-lg h-8 text-amber-400 font-bold';
                speak("ä¸å°å–”ï¼Œå†æƒ³ä¸€æƒ³");
                quizAnswerEl.value = '';
            }
        }
        
        startQuizBtn.addEventListener('click', () => {
            initializeAudio(); // åœ¨ç¬¬ä¸€æ¬¡é»æ“Šæ™‚åˆå§‹åŒ–æ‰€æœ‰éŸ³è¨Š
            if(backgroundMusic && backgroundMusic.state !== "started") {
                backgroundMusic.start(); // **ä¿®å¾©**ï¼šç¢ºä¿éŸ³æ¨‚åªåœ¨åˆå§‹åŒ–å¾Œå•Ÿå‹•
            }
            playClickSound();
            
            startQuizContainer.classList.add('hidden');
            quizSection.classList.remove('hidden');
            generateNewQuestion();
        });

        newQuestionBtn.addEventListener('click', () => {
            playClickSound();
            generateNewQuestion();
        });

        checkAnswerBtn.addEventListener('click', checkAnswer);
        quizAnswerEl.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') checkAnswer();
        });

        // --- å£è¨£è¡¨ç”¢ç”Ÿç¨‹å¼ç¢¼ ---
        for (let i = 1; i <= 9; i++) {
            for (let j = 1; j <= 9; j++) {
                const button = document.createElement('button');
                const colorClass = spaceColors[(i - 1) % spaceColors.length];
                button.className = `btn-speak ${colorClass} text-white font-bold p-2 rounded-xl shadow-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75 flex flex-col items-center justify-center aspect-square`;
                const emoji_i = spaceEmojis[i - 1];
                button.innerHTML = `
                    <div class="text-3xl sm:text-4xl" aria-hidden="true">${emoji_i}</div>
                    <div class="text-sm sm:text-base mt-1 font-semibold">${i} Ã— ${j} = ${i * j}</div>
                `;
                button.setAttribute('aria-label', `${i} ä¹˜ ${j} ç­‰æ–¼ ${i*j}ã€‚å£è¨£æ˜¯ï¼š${mnemonics[Math.min(i,j)][Math.max(i,j)]}`);
                button.addEventListener('click', () => {
                    playClickSound();
                    const num1 = Math.min(i, j);
                    const num2 = Math.max(i, j);
                    const mnemonic = mnemonics[num1][num2];
                    speak(mnemonic);
                });
                tableContainer.appendChild(button);
            }
        }
    </script>
</body>
</html>

